<ion-header>
  <ion-toolbar class="modern-toolbar">
    
    <ion-title class="page-title">
      <div class="title-content">
        <h1>POINT OF SALE</h1>
      </div>
    </ion-title>
    
    <ion-buttons slot="end">
      <ion-button class="cart-button" (click)="openCart()">
        <div class="cart-icon-container">
          <i class="fas fa-shopping-cart"></i>
          <ion-badge color="danger" class="cart-badge" *ngIf="cartItems.length > 0">
            {{cartItems.length}}
          </ion-badge>
        </div>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="modern-pos-content">
  <section class="search-section">
    <div class="search-container">
      <div class="search-box">
        <ion-searchbar 
          placeholder="Search products..." 
          (ionInput)="searchProducts($event)"
          class="modern-searchbar">
        </ion-searchbar>
      </div>
    </div>
  </section>

  <section class="categories-section">
    <div class="categories-container">
      <ion-segment 
        [value]="selectedCategory" 
        (ionChange)="filterByCategory($event)" 
        class="modern-segment" 
        scrollable="true" 
        mode="md">

        <ion-segment-button value="all" class="category-btn">
          <div class="category-content">
            <ion-label>All</ion-label>
          </div>
        </ion-segment-button>

        <ion-segment-button *ngFor="let cat of categories" [value]="cat" class="category-btn">
          <div class="category-content">
            <ion-label>{{ cat | titlecase }}</ion-label>
          </div>
        </ion-segment-button>

      </ion-segment>
    </div>
  </section>


  <section class="products-section">
    <div class="section-header horizontal-header">
      <div class="header-left">
        <h2>Available Products</h2>
        <p class="product-count">{{filteredProducts.length}} products found</p>
      </div>

      <ion-button class="scan-btn" (click)="openScannerModal()" fill="solid" color="primary" size="small">
        <i class="fas fa-barcode"></i> Scan Product
      </ion-button>
    </div>

    <ion-grid class="products-grid">
      <ion-row>
        <ion-col size="6" size-md="4" size-lg="3" *ngFor="let product of filteredProducts">
          <ion-card class="modern-product-card" (click)="addToCart(product)">
            <div class="product-badge" *ngIf="product.quantity < 10">
              <i class="fas fa-exclamation-circle"></i>
              Low Stock
            </div>
            
            <div class="image-container">
              <ion-img [src]="product.image" [alt]="product.name" class="product-image"></ion-img>
              <div class="image-overlay">
                <i class="fas fa-cart-plus"></i>
              </div>
            </div>
            
            <ion-card-header class="product-header">
              <ion-card-title class="product-name">{{product.name}}</ion-card-title>
              <ion-card-subtitle class="product-category">
                <i class="fas fa-tag"></i>
                {{product.category}}
              </ion-card-subtitle>
            </ion-card-header>
            
            <ion-card-content class="product-content">
              <div class="price-section">
                <div class="price">â‚±{{product.price | number:'1.2-2'}}</div>
                <div class="stock" [class.low-stock]="product.quantity < 10">
                  <i class="fas fa-box"></i>
                  {{product.quantity}} in stock
                </div>
              </div>
              
              <ion-button class="add-to-cart-btn" fill="solid" size="small">
                <i class="fas fa-plus"></i>
                Add to Cart
              </ion-button>
            </ion-card-content>
          </ion-card>
        </ion-col>
      </ion-row>
    </ion-grid>

    <div class="modern-empty-state" *ngIf="filteredProducts.length === 0">
      <div class="empty-icon">
        <i class="fas fa-search"></i>
      </div>
      <h3>No products found</h3>
      <p>Try adjusting your search or filter criteria</p>
      <ion-button fill="solid" class="reset-filters-btn">
        <i class="fas fa-redo"></i>
        Reset Filters
      </ion-button>
    </div>
  </section>
</ion-content>

<ion-modal [isOpen]="isCartOpen" (didDismiss)="closeCart()" class="modern-cart-modal">
  <ng-template>
    <ion-header class="cart-header">
      <ion-toolbar>
        <ion-buttons slot="start">
          <ion-button (click)="closeCart()" class="close-btn">
            <i class="fas fa-arrow-left"></i>
          </ion-button>
        </ion-buttons>
        
        <ion-title class="cart-title">
          <div class="title-with-badge">
            <h2>Shopping Cart</h2>
            <ion-badge color="primary" *ngIf="cartItems.length > 0">
              {{cartItems.length}} items
            </ion-badge>
          </div>
        </ion-title>
        
        <ion-buttons slot="end">
          <ion-button (click)="clearCart()" class="clear-btn" *ngIf="cartItems.length > 0">
            <i class="fas fa-trash"></i>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>
    
    <ion-content class="cart-content">
      <div class="cart-items-section" *ngIf="cartItems.length > 0">
        <div class="section-label">
          <i class="fas fa-shopping-basket"></i>
          Cart Items
        </div>
        
        <ion-list class="modern-cart-list">
          <ion-item *ngFor="let item of cartItems; let i = index" class="cart-item">
            <ion-avatar slot="start" class="item-avatar">
              <ion-img [src]="item.image"></ion-img>
            </ion-avatar>
            
            <ion-label class="item-details">
              <h3 class="item-name">{{item.name}}</h3>
              <p class="item-price">â‚±{{item.price | number:'1.2-2'}} each</p>
              <div class="quantity-controls">
                <ion-button (click)="decreaseQuantity(i)" class="qty-btn" fill="clear" size="small">
                  <i class="fas fa-minus"></i>
                </ion-button>
                
                <span class="quantity-display">{{item.cartQuantity}}</span>

                
                <ion-button (click)="increaseQuantity(i)" class="qty-btn" fill="clear" size="small">
                  <i class="fas fa-plus"></i>
                </ion-button>
              </div>
            </ion-label>
            
            <div class="item-total">
              <div class="total-amount">â‚±{{(item.price * item.cartQuantity) | number:'1.2-2'}}</div>
              <ion-button (click)="removeFromCart(i)" class="remove-btn" fill="clear" size="small">
                <i class="fas fa-times"></i>
              </ion-button>
            </div>
          </ion-item>
        </ion-list>
      </div>

      <div class="modern-empty-cart" *ngIf="cartItems.length === 0">
        <div class="empty-cart-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h3>Your cart is empty</h3>
        <p>Add some products to get started</p>
        <ion-button (click)="closeCart()" fill="solid" class="continue-shopping-btn">
          <i class="fas fa-shopping-bag"></i>
          Continue Shopping
        </ion-button>
      </div>

      <ion-card class="order-summary-card" *ngIf="cartItems.length > 0">
        <ion-card-header>
          <ion-card-title>
            <i class="fas fa-receipt"></i>
            Order Summary
          </ion-card-title>
        </ion-card-header>
        
        <ion-card-content>
          <div class="summary-item">
            <span class="summary-label">Subtotal</span>
            <span class="summary-value">â‚±{{getSubtotal() | number:'1.2-2'}}</span>
          </div>
          
          
          <div class="summary-divider"></div>
          
          <div class="summary-item total">
            <span class="summary-label">Total Amount</span>
            <span class="summary-value total-amount">â‚±{{getTotal() | number:'1.2-2'}}</span>
          </div>
        </ion-card-content>
      </ion-card>
    </ion-content>
    
    <ion-footer *ngIf="cartItems.length > 0" class="cart-footer">
      <ion-toolbar>
        <ion-grid class="footer-grid">
          <ion-row>
            <ion-col size="8">
              <div class="total-display">
                <div class="total-label">Total</div>
                <div class="total-price">â‚±{{getTotal() | number:'1.2-2'}}</div>
              </div>
            </ion-col>
            
            <ion-item>
              <ion-label position="stacked">Customer Payment</ion-label>
              <ion-input type="number" [(ngModel)]="customerPayment" (ionChange)="calculateChange()"></ion-input>
            </ion-item>

            <div *ngIf="customerPayment > 0">
              <p>Total Amount: â‚±{{getTotal() | number:'1.2-2'}}</p>
              <p>Change: â‚±{{changeAmount | number:'1.2-2'}}</p>
            </div>

            <ion-button (click)="checkout()" [disabled]="customerPayment < getTotal()" expand="block">
              Complete Payment
            </ion-button>

          </ion-row>
        </ion-grid>
      </ion-toolbar>
    </ion-footer>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="isReceiptOpen" (didDismiss)="isReceiptOpen = false" class="receipt-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar class="receipt-toolbar">
        <ion-title>
          <h2 class="receipt-title">ðŸ§¾ POS Receipt</h2>
        </ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="isReceiptOpen = false">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="receipt-content" fullscreen>
      <div class="receipt-header-section">
        <h3 class="store-name">TrackWise</h3>
        <p class="receipt-date">{{receiptData?.date | date:'medium'}}</p>
        <hr />
      </div>

      <ion-list class="receipt-items-list">
        <ion-item *ngFor="let item of receiptData?.items" lines="none" class="receipt-item">
          <ion-label class="item-label">
            <div class="item-name">{{item.name}}</div>
            <div class="item-quantity-price">
              <span>x{{item.cartQuantity}}</span>
              <span>â‚±{{(item.price * item.cartQuantity) | number:'1.2-2'}}</span>
            </div>
          </ion-label>
        </ion-item>
      </ion-list>
      <hr />

      <div class="receipt-summary">
        <div class="summary-row">
          <span>Subtotal</span>
          <span>â‚±{{receiptData?.total | number:'1.2-2'}}</span>
        </div>
        <div class="summary-row">
          <span>Payment</span>
          <span>â‚±{{receiptData?.payment | number:'1.2-2'}}</span>
        </div>
        <div class="summary-row total-row">
          <strong>Total</strong>
          <strong>â‚±{{receiptData?.total | number:'1.2-2'}}</strong>
        </div>
        <div class="summary-row change-row">
          <span>Change</span>
          <span>â‚±{{receiptData?.change | number:'1.2-2'}}</span>
        </div>
      </div>

      <div class="receipt-footer">
        <p>Thank you for shopping with us!</p>
        <ion-button expand="block" fill="outline" (click)="isReceiptOpen = false">
          Close
        </ion-button>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>

<ion-modal [isOpen]="isScannerOpen" (didDismiss)="closeScannerModal()" class="scanner-modal">
  <ng-template>
    <ion-header>
      <ion-toolbar>
        <ion-title>Scan Product</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="closeScannerModal()">
            <ion-icon name="close-outline"></ion-icon>
          </ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="scanner-content" fullscreen>
      <div class="scanner-container">
        <video #videoPreview autoplay muted playsinline></video>
        <p class="scanner-instruction">Point the camera at a product barcode</p>
        <p *ngIf="scanMessage" class="scan-message">{{ scanMessage }}</p>
      </div>
    </ion-content>
  </ng-template>
</ion-modal>