<ion-header>
  <ion-toolbar class="modern-toolbar" style="--padding-start: 20px; --padding-end: 20px; --padding-top: 0; --padding-bottom: 0;">
    <ion-title class="page-title" style="padding-inline-start: 0; padding-inline-end: 0; padding-top: 0; padding-bottom: 0; font-size: 1.25rem; font-weight: 500; letter-spacing: 0.0125em;">
      <div class="title-content">
        <h1 style="margin: 0; font-size: 1.5rem; font-weight: 800; color: #1e293b; text-transform: none; letter-spacing: -0.02em;">REPORTS</h1>
      </div>
    </ion-title>

    <ion-buttons slot="end">
      <ion-button
        (click)="exportToExcel()"
        [disabled]="isLoading"
        class="export-btn"
        fill="outline"
        style="height: 36px; margin: 0; margin-inline-start: 8px; --border-radius: 8px; font-size: 0.8rem; font-weight: 600;"
      >
        <i class="fas fa-file-excel"></i>
        Excel
      </ion-button>
      <ion-button
        (click)="printSalesReport()"
        [disabled]="isLoading"
        class="print-btn"
        fill="solid"
        style="height: 36px; margin: 0; margin-inline-start: 8px; --border-radius: 8px; font-size: 0.8rem; font-weight: 600; --background: #1e4a63;"
      >
        <i class="fas fa-print"></i>
        Print
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content class="modern-reports-content">
  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
    <h3>Generating Reports</h3>
    <p>Please wait while we compile your sales data...</p>
  </div>

  <div *ngIf="!isLoading" class="reports-content">
    <section class="overview-section">
      <div class="stats-grid">
        <ion-card class="stat-card sales-card">
          <ion-card-content>
            <div class="card-icon">
              <i class="fas fa-chart-line"></i>
            </div>
            <div class="card-content">
              <h3>Total Sales</h3>
              <h1>{{ formatCurrency(totalSales) }}</h1>
              <p>All-time revenue</p>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card transaction-card">
          <ion-card-content>
            <div class="card-icon">
              <i class="fas fa-receipt"></i>
            </div>
            <div class="card-content">
              <h3>Avg Transaction</h3>
              <h1>{{ formatCurrency(avgTransaction) }}</h1>
              <p>Per sale average</p>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card count-card">
          <ion-card-content>
            <div class="card-icon">
              <i class="fas fa-shopping-cart"></i>
            </div>
            <div class="card-content">
              <h3>Transactions</h3>
              <h1>{{ transactions }}</h1>
              <p>Total orders processed</p>
            </div>
          </ion-card-content>
        </ion-card>

        <ion-card class="stat-card items-card">
          <ion-card-content>
            <div class="card-icon">
              <i class="fas fa-cube"></i>
            </div>
            <div class="card-content">
              <h3>Items Sold</h3>
              <h1>{{ itemsSold }}</h1>
              <p>Total products sold</p>
            </div>
          </ion-card-content>
        </ion-card>
      </div>
    </section>

    <section class="top-products-section">
      <ion-card class="modern-card">
        <ion-card-header class="card-header">
          <div class="header-content">
            <div class="title-section">
              <i class="fas fa-trophy"></i>
              <ion-card-title>Top Selling Products</ion-card-title>
            </div>
            <ion-badge color="primary" class="count-badge">
              {{ topProducts.length }} products
            </ion-badge>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div class="products-list">
            <div
              class="product-item"
              *ngFor="let product of topProducts; let i = index"
            >
              <div class="product-rank" [class.top-rank]="i < 3">
                #{{ i + 1 }}
              </div>

              <div class="product-info">
                <div class="product-name">{{ product.name }}</div>
                <div class="product-meta">
                  <span class="quantity">
                    <i class="fas fa-cube"></i>
                    {{ product.quantity }} units sold
                  </span>
                </div>
              </div>

              <div class="product-total">
                {{ formatCurrency(product.total) }}
              </div>
            </div>
          </div>

          <div class="modern-empty-state" *ngIf="topProducts.length === 0">
            <div class="empty-icon">
              <i class="fas fa-chart-bar"></i>
            </div>
            <h3>No sales data available</h3>
            <p>Sales data will appear here after transactions are processed</p>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <section class="inventory-section">
      <ion-card class="modern-card">
        <ion-card-header class="card-header">
          <div class="header-content">
            <div class="title-section">
              <i class="fas fa-warehouse"></i>
              <ion-card-title>Inventory Movement</ion-card-title>
            </div>
            <ion-badge color="warning" class="count-badge">
              {{ inventoryMovement.length }} items
            </ion-badge>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div class="movement-list">
            <div
              class="movement-item"
              *ngFor="let movement of inventoryMovement"
            >
              <div class="product-avatar">
                <i class="fas fa-box"></i>
              </div>

              <div class="movement-info">
                <div class="product-name">{{ movement.productName }}</div>
                <div class="stock-info">
                  <span class="current-stock">
                    <i class="fas fa-layer-group"></i>
                    Current: {{ movement.currentStock }}
                  </span>
                </div>
              </div>

              <div
                class="movement-change"
                [class.positive]="movement.change >= 0"
                [class.negative]="movement.change < 0"
              >
                <i
                  class="fas"
                  [class.fa-arrow-up]="movement.change >= 0"
                  [class.fa-arrow-down]="movement.change < 0"
                ></i>
                {{ movement.change >= 0 ? '+' : '' }}{{ movement.change }}
              </div>
            </div>
          </div>

          <div
            class="modern-empty-state"
            *ngIf="inventoryMovement.length === 0"
          >
            <div class="empty-icon">
              <i class="fas fa-cubes"></i>
            </div>
            <h3>No inventory movements</h3>
            <p>
              Inventory changes will appear here as products are sold or
              restocked
            </p>
          </div>
        </ion-card-content>
      </ion-card>
    </section>

    <section class="orders-section">
      <ion-card class="modern-card">
        <ion-card-header class="card-header">
          <div class="header-content">
            <div class="title-section">
              <i class="fas fa-clock"></i>
              <ion-card-title>Recent Orders</ion-card-title>
            </div>
            <ion-badge color="success" class="count-badge">
              {{ orders.length }} total
            </ion-badge>
          </div>
        </ion-card-header>

        <ion-card-content>
          <div class="orders-list">
            <div class="order-item" *ngFor="let order of orders.slice(0, 5)">
              <div class="order-avatar">
                <i class="fas fa-receipt"></i>
              </div>

              <div class="order-info">
                <div class="order-id">
                  Order #{{ order.id?.substring(0, 8) }}
                </div>
                <div class="order-meta">
                  <span class="order-date">
                    <i class="fas fa-calendar"></i>
                    {{ getOrderDate(order.createdAt) | date:'medium' }}
                  </span>
                  <span class="order-items">
                    <i class="fas fa-cube"></i>
                    {{ order.items.length }} items
                  </span>
                </div>
              </div>

              <div class="order-total">{{ formatCurrency(order.total) }}</div>
            </div>
          </div>

          <div class="modern-empty-state" *ngIf="orders.length === 0">
            <div class="empty-icon">
              <i class="fas fa-shopping-bag"></i>
            </div>
            <h3>No orders yet</h3>
            <p>Customer orders will appear here after successful checkouts</p>
          </div>
        </ion-card-content>
      </ion-card>
    </section>
  </div>
</ion-content>

<div id="printContent" style="display: none;">
  <div class="print-header">
    <h1>Sales Report</h1>
    <p>Generated on: {{ currentDate | date:'medium' }}</p>
  </div>
  
  <div class="print-summary">
    <h2>Summary</h2>
    <table>
      <tr>
        <td><strong>Total Sales:</strong></td>
        <td>{{ formatCurrency(totalSales) }}</td>
      </tr>
      <tr>
        <td><strong>Total Transactions:</strong></td>
        <td>{{ transactions }}</td>
      </tr>
      <tr>
        <td><strong>Average Transaction:</strong></td>
        <td>{{ formatCurrency(avgTransaction) }}</td>
      </tr>
      <tr>
        <td><strong>Items Sold:</strong></td>
        <td>{{ itemsSold }}</td>
      </tr>
    </table>
  </div>

  <div class="print-top-products" *ngIf="topProducts.length > 0">
    <h2>Top Selling Products</h2>
    <table>
      <thead>
        <tr>
          <th>Rank</th>
          <th>Product Name</th>
          <th>Quantity Sold</th>
          <th>Total Revenue</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let product of topProducts; let i = index">
          <td>#{{ i + 1 }}</td>
          <td>{{ product.name }}</td>
          <td>{{ product.quantity }}</td>
          <td>{{ formatCurrency(product.total) }}</td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="print-inventory" *ngIf="inventoryMovement.length > 0">
    <h2>Inventory Movement</h2>
    <table>
      <thead>
        <tr>
          <th>Product Name</th>
          <th>Current Stock</th>
          <th>Stock Change</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let movement of inventoryMovement">
          <td>{{ movement.productName }}</td>
          <td>{{ movement.currentStock }}</td>
          <td [class.positive]="movement.change >= 0" [class.negative]="movement.change < 0">
            {{ movement.change >= 0 ? '+' : '' }}{{ movement.change }}
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div class="print-recent-orders" *ngIf="orders.length > 0">
    <h2>Recent Orders</h2>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Date</th>
          <th>Items</th>
          <th>Total</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let order of orders.slice(0, 10)">
          <td>#{{ order.id?.substring(0, 8) }}</td>
          <td>{{ getOrderDate(order.createdAt) | date:'short' }}</td>
          <td>{{ order.items.length }}</td>
          <td>{{ formatCurrency(order.total) }}</td>
        </tr>
      </tbody>
    </table>
  </div>
</div>