<ion-header>
  <ion-toolbar class="modern-toolbar">
    <ion-title class="page-title">
      <div class="title-content">
        <h1>Dashboard</h1>
      </div>
    </ion-title>

    <ion-buttons slot="end">
      <ion-button class="logout-button" (click)="logout()">
        <i class="fas fa-sign-out-alt menu-icon"></i>
        Logout
      </ion-button>
      
      <!-- <ion-button class="user-button" (click)="toggleProfileDropdown($event)">
        <ion-avatar class="user-avatar">
          <img [src]="user?.avatar || 'assets/images/user-avatar.png'" alt="Profile" />
        </ion-avatar>
      </ion-button> -->
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [id]="contentId" class="modern-content">

  <div class="loading-container" *ngIf="isLoading">
    <div class="loading-spinner">
      <ion-spinner name="crescent"></ion-spinner>
    </div>
    <h3>Loading Customer Data</h3>
    <p>Getting the latest business insights...</p>
  </div>

  <div *ngIf="!isLoading" class="dashboard-content">

    <section class="stats-section">
      <div class="section-header">
        <h2>Dashboard Overview</h2>
        <p>Key performance indicators at a glance</p>
      </div>
      
      <ion-grid class="stats-grid">
        <ion-row>
          <ion-col size="12" size-md="6" size-lg="3">
            <ion-card class="stat-card sales-card">
              <div class="card-bg-icon">
                <i class="fas fa-dollar-sign"></i>
              </div>
              <ion-card-header>
                <div class="card-icon">
                  <i class="fas fa-chart-line"></i>
                </div>
                <ion-card-title>{{ formatCurrency(salesData.totalSales) }}</ion-card-title>
                <ion-card-subtitle>Total Sales</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="trend" [class.positive]="salesData.trend >= 0" [class.negative]="salesData.trend < 0">
                  <i class="fas" [class.fa-arrow-up]="salesData.trend >= 0" [class.fa-arrow-down]="salesData.trend < 0"></i>
                  <span>{{ Math.abs(salesData.trend) }}% {{ salesData.trend >= 0 ? 'increase' : 'decrease' }}</span>
                </div>
                <div class="period">vs last period</div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-md="6" size-lg="3">
            <ion-card class="stat-card products-card">
              <div class="card-bg-icon">
                <i class="fas fa-cube"></i>
              </div>
              <ion-card-header>
                <div class="card-icon">
                  <i class="fas fa-boxes"></i>
                </div>
                <ion-card-title>{{ inventoryData.totalProducts }}</ion-card-title>
                <ion-card-subtitle>Total Products</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="stock-info">
                  <div class="stock-item">
                    <span class="stock-label">In Stock</span>
                    <span class="stock-value">{{ inventoryData.inStock }}</span>
                  </div>
                  <div class="stock-item">
                    <span class="stock-label">Out of Stock</span>
                    <span class="stock-value">{{ inventoryData.totalProducts - inventoryData.inStock }}</span>
                  </div>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-md="6" size-lg="3">
            <ion-card class="stat-card alert-card">
              <div class="card-bg-icon">
                <i class="fas fa-exclamation-triangle"></i>
              </div>
              <ion-card-header>
                <div class="card-icon">
                  <i class="fas fa-bell"></i>
                </div>
                <ion-card-title>{{ inventoryData.lowStockCount }}</ion-card-title>
                <ion-card-subtitle>Low Stock</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="alert-status" *ngIf="inventoryData.lowStockCount > 0">
                  <i class="fas fa-exclamation-circle"></i>
                  <span>Needs attention</span>
                </div>
                <div class="alert-status good" *ngIf="inventoryData.lowStockCount === 0">
                  <i class="fas fa-check-circle"></i>
                  <span>All good</span>
                </div>
                <div class="period">Products below threshold</div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-md="6" size-lg="3">
            <ion-card class="stat-card orders-card">
              <div class="card-bg-icon">
                <i class="fas fa-shopping-cart"></i>
              </div>
              <ion-card-header>
                <div class="card-icon">
                  <i class="fas fa-receipt"></i>
                </div>
                <ion-card-title>{{ salesData.totalOrders }}</ion-card-title>
                <ion-card-subtitle>Total Orders</ion-card-subtitle>
              </ion-card-header>
              <ion-card-content>
                <div class="trend" [class.positive]="salesData.orderTrend >= 0" [class.negative]="salesData.orderTrend < 0">
                  <i class="fas" [class.fa-arrow-up]="salesData.orderTrend >= 0" [class.fa-arrow-down]="salesData.orderTrend < 0"></i>
                  <span>{{ Math.abs(salesData.orderTrend) }}% {{ salesData.orderTrend >= 0 ? 'increase' : 'decrease' }}</span>
                </div>
                <div class="period">vs last period</div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </section>

    <section class="charts-section">
      <div class="section-header">
        <h2>Performance Analytics</h2>
        <p>Track your sales and product performance</p>
      </div>
      
      <ion-grid class="charts-grid">
        <ion-row>
          <ion-col size="12" size-lg="8">
            <ion-card class="chart-card">
              <ion-card-header>
                <div class="chart-header">
                  <div class="chart-title">
                    <ion-card-title>Sales Overview</ion-card-title>
                    <ion-card-subtitle>{{ getPeriodLabel() }} Performance</ion-card-subtitle>
                  </div>
                  <ion-segment [(ngModel)]="selectedPeriod" (ionChange)="onPeriodChange()" class="chart-period-selector">
                    <ion-segment-button value="today">
                      <ion-label>Today</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="weekly">
                      <ion-label>Weekly</ion-label>
                    </ion-segment-button>
                    <ion-segment-button value="monthly">
                      <ion-label>Monthly</ion-label>
                    </ion-segment-button>
                  </ion-segment>
                </div>
              </ion-card-header>
              <ion-card-content>
                <div class="chart-container">
                  <div class="chart-wrapper">
                    <canvas #salesChartCanvas></canvas>
                  </div>
                  <!-- <div class="chart-legend" *ngIf="salesChartData.length > 0">
                    <div class="legend-item" *ngFor="let data of salesChartData">
                      <span class="legend-color" [style.background]="data.color"></span>
                      <span class="legend-label">{{ data.label }}</span>
                      <span class="legend-value">{{ formatCurrency(data.sales) }}</span>
                    </div>
                  </div> -->
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>

          <ion-col size="12" size-lg="4">
            <ion-card class="chart-card">
              <ion-card-header>
                <div class="chart-header">
                  <div class="chart-title">
                    <ion-card-title>Top Products</ion-card-title>
                    <ion-card-subtitle>Best Sellers</ion-card-subtitle>
                  </div>
                <ion-button routerLink="/dashboard/inventory" fill="clear" class="view-all-button">
                  View All
                  <i class="fas fa-chevron-right"></i>
                </ion-button>

                </div>
              </ion-card-header>
              <ion-card-content>
                <div class="top-products-list">
                  <div class="product-item" *ngFor="let product of topProducts; let i = index">
                    <div class="product-rank" [class.top-rank]="i < 3">#{{ i + 1 }}</div>
                    <div class="product-info">
                      <div class="product-name">{{ product.name }}</div>
                      <div class="product-sales">{{ product.quantity }} sold</div>
                    </div>
                    <div class="product-amount">{{ formatCurrency(product.total) }}</div>
                  </div>
                </div>
                
                <div class="empty-state" *ngIf="topProducts.length === 0">
                  <i class="fas fa-chart-bar"></i>
                  <h3>No sales data</h3>
                  <p>Sales data will appear here</p>
                </div>
              </ion-card-content>
            </ion-card>
          </ion-col>
        </ion-row>
      </ion-grid>
    </section>

    <section class="alerts-section" *ngIf="inventoryData.lowStockItems.length > 0">
      <div class="section-header">
        <h2>Inventory Alerts</h2>
        <p>Products that need your attention</p>
      </div>
      
      <ion-card class="alerts-card">
        <ion-card-header>
          <div class="alert-header">
            <div class="alert-title">
              <i class="fas fa-exclamation-triangle"></i>
              <ion-card-title>Low Stock Alerts</ion-card-title>
            </div>
            <ion-badge color="warning" class="alert-count">{{ inventoryData.lowStockItems.length }}</ion-badge>
          </div>
          <ion-card-subtitle>Products needing restock</ion-card-subtitle>
        </ion-card-header>
        <ion-card-content>
          <ion-list lines="none" class="alert-list">
            <ion-item *ngFor="let item of inventoryData.lowStockItems" class="alert-item">
              <ion-avatar slot="start" class="product-avatar">
                <img [src]="item.image || 'assets/images/product-placeholder.png'" [alt]="item.name" />
              </ion-avatar>
              <ion-label>
                <h3>{{ item.name }}</h3>
                <p>Current stock: {{ item.currentStock }}</p>
                <!-- <p class="stock-threshold">Threshold: {{ item.threshold }}</p> -->
              </ion-label>
              <!-- <div class="alert-actions" slot="end">
                <ion-button fill="clear" size="small" class="action-button">
                  <i class="fas fa-edit"></i>
                </ion-button>
                <ion-button fill="clear" size="small" class="action-button">
                  <i class="fas fa-sync-alt"></i>
                </ion-button>
              </div> -->
            </ion-item>
          </ion-list>
        </ion-card-content>
      </ion-card>
    </section>
  </div>
</ion-content>
